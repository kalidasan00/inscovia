// backend/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum InstituteCategory {
  SCHOOL_TUITION
  STUDY_ABROAD
  LANGUAGES
  IT_TECHNOLOGY
  DESIGN_CREATIVE
  MANAGEMENT
  SKILL_DEVELOPMENT
  EXAM_COACHING
}

enum CenterCategory {
  SCHOOL_TUITION
  STUDY_ABROAD
  LANGUAGES
  IT_TECHNOLOGY
  DESIGN_CREATIVE
  MANAGEMENT
  SKILL_DEVELOPMENT
  EXAM_COACHING
}

enum UserRole {
  ADMIN
  INSTITUTE
  USER
}

enum TeachingMode {
  ONLINE
  OFFLINE
  HYBRID
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ALERT
}

model InstituteUser {
  id       String   @id @default(cuid())
  email    String   @unique
  password String

  instituteName       String
  phone               String
  primaryCategory     InstituteCategory
  secondaryCategories InstituteCategory[] @default([])
  teachingMode        TeachingMode

  state    String
  district String
  city     String
  location String

  role       UserRole @default(INSTITUTE)
  isVerified Boolean  @default(false)
  isActive   Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  centers       Center[]
  notifications Notification[]

  @@index([email])
  @@index([primaryCategory])
  @@index([teachingMode])
  @@index([role])
  @@index([city])
  @@index([state])
  @@index([city, state])
}

model Center {
  id   String         @id @default(cuid())
  slug String         @unique
  name String
  primaryCategory     CenterCategory
  secondaryCategories CenterCategory[] @default([])
  teachingMode        TeachingMode

  state    String
  district String
  city     String
  location String

  rating  Float    @default(0)
  courses String[]

  courseDetails Json? @default("[]")

  image   String?
  logo    String?
  gallery String[] @default([])

  description String @db.Text

  website  String?
  whatsapp String?
  phone    String?
  email    String?

  facebook  String?
  instagram String?
  linkedin  String?

  countries        String[]  @default([])
  services         String[]  @default([])
  topUniversities  String[]  @default([])
  avgScholarship   String?
  successRate      String?
  studentsPlaced   Int?

  userId String?
  owner  InstituteUser? @relation(fields: [userId], references: [id], onDelete: Cascade)

  reviews Review[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([state, district, city])
  @@index([userId])
  @@index([primaryCategory])
  @@index([teachingMode])
  @@index([city])
  @@index([state])
  @@index([rating])
}

model Review {
  id        String   @id @default(cuid())

  userName  String
  userEmail String
  rating    Int
  comment   String   @db.Text

  centerId  String
  center    Center   @relation(fields: [centerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([centerId])
  @@unique([userEmail, centerId])
  @@index([rating])
  @@index([createdAt])
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  phone     String
  gender    String
  password  String

  isVerified Boolean  @default(false)
  isActive   Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  notifications Notification[]

  @@index([email])
}

model PreviousYearPaper {
  id           String   @id @default(cuid())
  slug         String   @unique

  examName     String
  examCategory String
  subject      String?
  year         Int
  shift        String?
  language     String   @default("English")

  pdfUrl       String
  fileSize     String?

  downloads    Int      @default(0)
  isActive     Boolean  @default(true)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([slug])
  @@index([examName])
  @@index([examCategory])
  @@index([year])
  @@index([isActive])
}

model AptitudeQuestion {
  id          String     @id @default(cuid())

  question    String     @db.Text
  optionA     String
  optionB     String
  optionC     String
  optionD     String
  answer      String
  explanation String     @db.Text

  topic       String
  subtopic    String
  difficulty  Difficulty @default(EASY)

  isActive    Boolean    @default(true)

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@index([topic])
  @@index([subtopic])
  @@index([difficulty])
  @@index([isActive])
  @@index([topic, subtopic])
  @@index([topic, difficulty])
}

model Notification {
  id      String           @id @default(cuid())
  title   String
  message String           @db.Text
  type    NotificationType @default(INFO)
  isRead  Boolean          @default(false)

  // Institute notification — null = broadcast to all institutes
  instituteId String?
  institute   InstituteUser? @relation(fields: [instituteId], references: [id], onDelete: Cascade)

  // User notification — null = broadcast to all users
  userId String?
  user   User?  @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([instituteId])
  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
}
