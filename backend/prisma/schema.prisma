// backend/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums for categories
enum InstituteCategory {
  TECHNOLOGY
  MANAGEMENT
  SKILL_DEVELOPMENT
  EXAM_COACHING
}

enum CenterCategory {
  TECHNOLOGY
  MANAGEMENT
  SKILL_DEVELOPMENT
  EXAM_COACHING
}

enum UserRole {
  ADMIN
  INSTITUTE
  USER
}

enum TeachingMode {
  ONLINE
  OFFLINE
  HYBRID
}

// Institute User for Authentication
model InstituteUser {
  id       String   @id @default(cuid())
  email    String   @unique
  password String

  instituteName       String
  phone               String
  primaryCategory     InstituteCategory              // Primary category (required)
  secondaryCategories InstituteCategory[] @default([]) // Secondary categories (optional)
  teachingMode        TeachingMode                   // Online, Offline, or Hybrid

  state    String
  district String
  city     String
  location String

  role       UserRole @default(INSTITUTE)
  isVerified Boolean  @default(false)
  isActive   Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  centers Center[]

  @@index([email])
  @@index([primaryCategory])
  @@index([teachingMode])
  @@index([role])
  @@index([city])
  @@index([state])
  @@index([city, state])
}

model Center {
  id   String         @id @default(cuid())
  name String
  primaryCategory     CenterCategory              // Primary category (required)
  secondaryCategories CenterCategory[] @default([]) // Secondary categories (optional)
  teachingMode        TeachingMode                // Online, Offline, or Hybrid

  state    String
  district String
  city     String
  location String

  rating  Float    @default(0)
  courses String[]

  image   String?
  logo    String?
  gallery String[] @default([])

  description String @db.Text

  website  String?
  whatsapp String?
  phone    String?
  email    String?

  facebook  String?
  instagram String?
  linkedin  String?

  userId String?
  owner  InstituteUser? @relation(fields: [userId], references: [id], onDelete: Cascade)

  reviews Review[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([state, district, city])
  @@index([userId])
  @@index([primaryCategory])
  @@index([teachingMode])
  @@index([city])
  @@index([state])
  @@index([rating])
}

model Review {
  id        String   @id @default(cuid())

  userName  String
  userEmail String
  rating    Int
  comment   String   @db.Text

  centerId  String
  center    Center   @relation(fields: [centerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([centerId])
  @@unique([userEmail, centerId])
  @@index([rating])
  @@index([createdAt])
}

// Student/Regular User for Authentication
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  phone     String
  gender    String
  password  String

  isVerified Boolean  @default(false)
  isActive   Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}