// backend/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum InstituteCategory {
  TECHNOLOGY
  COMPETITIVE_EXAMS
  LANGUAGE_TRAINING
  MANAGEMENT
  PROFESSIONAL_COURSES
  DESIGN_CREATIVE
  DIGITAL_MARKETING
  SKILL_DEVELOPMENT
  EXAM_COACHING
  STUDY_ABROAD        // ✅ NEW
}

enum CenterCategory {
  TECHNOLOGY
  COMPETITIVE_EXAMS
  LANGUAGE_TRAINING
  MANAGEMENT
  PROFESSIONAL_COURSES
  DESIGN_CREATIVE
  DIGITAL_MARKETING
  SKILL_DEVELOPMENT
  EXAM_COACHING
  STUDY_ABROAD        // ✅ NEW
}

enum UserRole {
  ADMIN
  INSTITUTE
  USER
}

enum TeachingMode {
  ONLINE
  OFFLINE
  HYBRID
}

model InstituteUser {
  id       String   @id @default(cuid())
  email    String   @unique
  password String

  instituteName       String
  phone               String
  primaryCategory     InstituteCategory
  secondaryCategories InstituteCategory[] @default([])
  teachingMode        TeachingMode

  state    String
  district String
  city     String
  location String

  role       UserRole @default(INSTITUTE)
  isVerified Boolean  @default(false)
  isActive   Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  centers Center[]

  @@index([email])
  @@index([primaryCategory])
  @@index([teachingMode])
  @@index([role])
  @@index([city])
  @@index([state])
  @@index([city, state])
}

model Center {
  id   String         @id @default(cuid())
  slug String         @unique
  name String
  primaryCategory     CenterCategory
  secondaryCategories CenterCategory[] @default([])
  teachingMode        TeachingMode

  state    String
  district String
  city     String
  location String

  rating  Float    @default(0)
  courses String[]

  courseDetails Json? @default("[]")

  image   String?
  logo    String?
  gallery String[] @default([])

  description String @db.Text

  website  String?
  whatsapp String?
  phone    String?
  email    String?

  facebook  String?
  instagram String?
  linkedin  String?

  // ✅ NEW: Study Abroad specific fields (null for non-study-abroad centers)
  countries        String[]  @default([])  // e.g. ["USA", "UK", "Canada"]
  services         String[]  @default([])  // e.g. ["Visa Assistance", "IELTS Coaching"]
  topUniversities  String[]  @default([])  // e.g. ["Harvard", "Oxford"]
  avgScholarship   String?                 // e.g. "50% - 100%"
  successRate      String?                 // e.g. "95%"
  studentsPlaced   Int?                    // e.g. 500

  userId String?
  owner  InstituteUser? @relation(fields: [userId], references: [id], onDelete: Cascade)

  reviews Review[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([state, district, city])
  @@index([userId])
  @@index([primaryCategory])
  @@index([teachingMode])
  @@index([city])
  @@index([state])
  @@index([rating])
}

model Review {
  id        String   @id @default(cuid())

  userName  String
  userEmail String
  rating    Int
  comment   String   @db.Text

  centerId  String
  center    Center   @relation(fields: [centerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([centerId])
  @@unique([userEmail, centerId])
  @@index([rating])
  @@index([createdAt])
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  phone     String
  gender    String
  password  String

  isVerified Boolean  @default(false)
  isActive   Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}

// ✅ Previous Year Question Papers
model PreviousYearPaper {
  id           String   @id @default(cuid())
  slug         String   @unique

  examName     String
  examCategory String
  subject      String?
  year         Int
  shift        String?
  language     String   @default("English")

  pdfUrl       String
  fileSize     String?

  downloads    Int      @default(0)
  isActive     Boolean  @default(true)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([slug])
  @@index([examName])
  @@index([examCategory])
  @@index([year])
  @@index([isActive])
}
